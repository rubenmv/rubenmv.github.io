<!DOCTYPE html>
<html>
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>
  
  Generación mediante BSP Tree &middot; Rubén Martínez Vilar
  
  </title>
  <!-- CSS -->
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:700,400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->
  <link rel="stylesheet" href="/css/main.css">
  <!-- Icons -->
  <link rel="shortcut icon" href="/img/favicon.ico">
  <!-- RSS -->
  <!-- <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"> -->
</head>

<body>
  <header class="main-header">
    <!-- MAIN MENU -->
<nav class="site-menu pure-menu pure-menu-horizontal">
  <a href="/" class="pure-menu-heading pure-menu-link">Rubén Martínez Vilar</a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item"><a class="pure-menu-link" href="/#about">About</a></li>
    <li class="pure-menu-item"><a class="pure-menu-link" href="/#projects">Projects</a></li>
    <li class="pure-menu-item"><a class="pure-menu-link" href="/blog/#posts">Blog</a></li>
    <li class="pure-menu-item"><a class="pure-menu-link" href="/#contact">Contact</a></li>
    <li class="pure-menu-item"><a class="pure-menu-link" href="https://dl.dropboxusercontent.com/u/15074300/RubenMartinezVilar-CV.pdf">CV</a></li>
  </ul>
</nav>

<div class="pure-menu pure-menu-horizontal">
    <ul class="pure-menu-list">
        <li class="pure-menu-item pure-menu-selected"><a href="#" class="pure-menu-link">Home</a></li>
        <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            <a href="#" id="menuLink1" class="pure-menu-link">Contact</a>
            <ul class="pure-menu-children">
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">Email</a></li>
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">Twitter</a></li>
                <li class="pure-menu-item"><a href="#" class="pure-menu-link">Tumblr Blog</a></li>
            </ul>
        </li>
    </ul>
</div>
  
  </header>
  <div class="page-content">
    <div class="post">

  <header class="post-header">
    <h3 class="post-title">Generación mediante BSP Tree</h3>
    <p class="post-meta">Apr 2, 2015</p>
  </header>

  <article class="post-content">
    <h1 id="particionado-bsp">Particionado BSP</h1>
<p>Esta técnica utiliza el particionado binario para subdividir un espacio utilizando hiperplanos. Las subdivisiones obtenidas son representadas mediante una estructura de datos de tipo árbol, conocida como BSP Tree o Árbol BSP.</p>

<h1 id="por-qu-utilizar-un-rbol-bsp">¿Por qué utilizar un árbol BSP?</h1>
<p>Cuando vamos a generar un mapa de mazmorra, hay muchas maneras de hacerlo, simplemente podríamos generar rectángulos de tamaños y en posiciones aleatorias y crear una habitación en cada uno, pero esto puede llevar a muchos problemas, como la superposición de habitaciones, espacios entre estas demasiado arbitrarios y extraños, como obtener algunas habitaciones muy juntas y otras muy separadas. Si entonces queremos pulir el algoritmo y arreglar estos problemas la complejidad de la solución se vuelve grande y es más difícil de depurar nuevos problemas.</p>

<p>La misma estructura de un árbol binario nos permite dividir el espacio de manera más o menos regular, manteniendo la consistencia entre el espacio entre habitaciones, los tamaños de estas y permitiéndonos unir mediante pasillos basándonos directamente en la unión de los mismos nodos del árbol.</p>

<p>El método procedería de la siguiente manera:</p>

<ol>
  <li>Creamos un plano completo sobre el que vamos a generar las habitaciones de la mazmorra. Este espacio completo es la raíz del árbol.
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_1.PNG" alt="bsp tree 1" /></li>
  <li>Escogemos una orientación aleatoria, horizontal o vertical, sobre la que vamos a partir.</li>
  <li>Escogemos un punto en x (horizontal) o en y (vertical) según la orientación escogida y partimos el espacio en dos sub-mazmorras.
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_2.PNG" alt="bsp tree 2" /></li>
  <li>Seguimos subdividiendo esas sub-mazmorras generadas pero teniendo cuidado que las divisiones no sean demasiado cerca del borde, ya que debemos ser capaces de poder incluir una habitación en cada una de estas divisiones.</li>
</ol>

<p>Aspecto en la segunda iteración.
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_3.PNG" alt="bsp tree 3" /></p>

<p>Aspecto en la última iteración. Cada uno de estos espacios incluirá una habitación.
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_8.PNG" alt="bsp tree 8" /></p>

<p><strong>¿Y cuándo nos detenemos?</strong></p>

<p>Tenemos varias opciones:
En cada iteración comprobamos si quedan espacios que puedan ser divididos y en las nuevas áreas se puedan crear al menos una habitación, seguimos dividiendo hasta que no queden espacios que cumplan esta condición. El problema con este método es que al final obtenemos áreas con muy dimensiones similares, por lo que las habitaciones también serán prácticamente iguales.
Otra solución es establecer un número de iteraciones fijo dependiendo del tamaño de la mazmorra, con lo que obtendremos áreas divididas al máximo posible, pero otras que se podrían dividir al menos una vez más, pero se quedan enteras y de esta manera se puede crear un habitación más grande y alargada o una habitación pequeña pero un pasillo largo que la une con otra sección.</p>

<ol>
  <li>Cuando tenemos las divisiones para incluir una sola habitación en cada una de estas, comenzamos a construir la mazmorra. Creamos una habitación de tamaño aleatorio dentro de cada división, es decir, cada hoja del árbol, teniendo en cuenta los límites del espacio.</li>
  <li>Para construir los pasillos que unen las habitaciones recorremos el árbol conectando cada nodo hoja con su hermana. Los nodos hoja son los nodos que no tiene más hijos, al final de cada rama del árbol.</li>
</ol>

<p>El resultado final para el ejemplo que hemos estado viendo sería como se ve en la siguiente imagen.
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_9.PNG" alt="bsp tree 9" /></p>

<p>Como vemos las habitaciones dentro de cada espacio se generan en una posición y con dimensiones aleatorias dentro de sus límites, por lo que podemos encontrar habitaciones pequeñas en espacio relativamente grande. Evidentemente estos parámetros se pueden ajustar si se desea que cada habitación rellene lo más en su espacio.</p>

<p>El utilizar un árbol binario nos asegura que después de realizar la primera partición vamos a obtener al menos dos hojas en dos ramas distintas que podemos utilizar como habitaciones de inicio y de final, estando siempre separadas por la raíz, por lo que nunca estarán conectadas directamente y se deberá recorrer primero la mayor parte del resto de habitaciones, algo que es esencial para el tipo de juego que queremos realizar en este caso.</p>

<p>Un segundo ejemplo generado mediante este método:
<img src="images/posts/2015-04-02-Generacion-mediante-BSP-Tree/bsp_9b.PNG" alt="bsp tree 9b" /></p>

<p>Como alternativa podemos utilizar un QuadTree para generar la mazmorra usando este tipo de técnica. En ese caso tendríamos cuatro nodos por cada partición y puede acelerar el proceso de creación, pero la diferencia es realmente mínima en estos casos.</p>

  </article>

</div>

  </div>
  <footer class="site-footer">
  <div>
    <p class="text"><a href="mailto:rub3nmv@gmail.com">rub3nmv@gmail.com</a><br>
    This site was made with <a href="http://jekyllrb.com/">Jekyll generator</a>, <a href="http://purecss.io/">PureCSS</a> and <a href="http://fortawesome.github.io/">Font Awesome</a>.</p>
  </div>
</footer> <!-- <script src="/js/jquery-1.11.3.min.js"></script> -->
<script src="/js/minified-legacyie.js"></script>
<script src="/js/utils.js"></script>

</body>

</html>
